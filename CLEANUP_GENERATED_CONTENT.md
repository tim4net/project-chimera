# üßπ Clear Generated Content to Test New Prompts

This will clear all LLM-generated content so we can test the improved prompts with fresh generation.

---

## Step 1: Open Supabase Dashboard

Go to: https://app.supabase.com/project/muhlitkerrjparpcuwmc/sql/new

---

## Step 2: Copy and Paste Each SQL Section

**‚ö†Ô∏è IMPORTANT: Execute each section in a SEPARATE SQL query window. Do NOT combine them.**

---

## Query 1: Clear Asset Cache

```sql
-- Clear asset request cache and generated images
DELETE FROM public.asset_requests;
DELETE FROM public.generated_images;
DELETE FROM public.generated_text WHERE asset_type = 'image';

-- Verify cleared
SELECT COUNT(*) as asset_requests_count FROM public.asset_requests;
SELECT COUNT(*) as generated_images_count FROM public.generated_images;
```

**Click "Execute" ‚úÖ**

Expected result: All three queries show COUNT = 0

---

## Query 2: Clear POI Descriptions

```sql
-- Clear POI descriptions (will be regenerated by background tasks)
DELETE FROM public.world_pois WHERE description LIKE '%';

-- Verify cleared
SELECT COUNT(*) as pois_with_descriptions FROM public.world_pois WHERE description IS NOT NULL;
```

**Click "Execute" ‚úÖ**

Expected result: Shows remaining POIs without descriptions (if any)

---

## Query 3: Clear Quest Templates

```sql
-- Clear quest templates (will be regenerated by background tasks)
DELETE FROM public.quest_templates;

-- Verify cleared
SELECT COUNT(*) as quest_templates_count FROM public.quest_templates;
```

**Click "Execute" ‚úÖ**

Expected result: COUNT = 0

---

## Step 3: Restart Backend

After all queries complete, restart the backend to pick up fresh data:

```bash
cd /srv/project-chimera
podman compose down
podman compose up -d
```

Wait 10 seconds for backend to start...

---

## Step 4: Monitor Fresh Generation

Check the backend logs to see new prompts in action:

```bash
podman compose logs -f backend --tail=100
```

Look for:
- ‚úÖ `[BackgroundTasks] ‚úÖ Generated quest: "..."` - New prompt working
- ‚ö†Ô∏è `[BackgroundTasks] ‚ö† Quest X parse failed: ...` - Parse issues
- ‚úÖ `[BackgroundTasks] ‚úÖ Generated POI: "..."` - POI generation with new prompt
- ‚úÖ `[NameGenerator] ‚úÖ ...` - Name generation with new prompt

---

## Step 5: Test Character Creation

After backend is running, create a new character to trigger name generation and POI generation:

```bash
# Or use the web UI at http://localhost:5173/create-character
curl -X POST http://localhost:3001/api/characters \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test Character",
    "race": "Elf",
    "class": "Wizard",
    "gender": "male"
  }'
```

---

## What Gets Cleared

| Table | Purpose | Will Regenerate |
|-------|---------|-----------------|
| `asset_requests` | Cached asset generation requests | Yes - on demand |
| `generated_images` | Cached generated portraits | Yes - on character creation |
| `world_pois` | POI descriptions | Yes - background tasks |
| `quest_templates` | Quest templates | Yes - background tasks |
| `generated_text` | Cached text generation | Yes - on demand |

---

## What Does NOT Get Cleared

‚úÖ Characters (safe to keep)
‚úÖ Character stats and equipment
‚úÖ Completed quests
‚úÖ Journal entries
‚úÖ World map and landmarks

---

## Verification

After fresh generation, check the status endpoint:

```bash
curl -s http://localhost:3001/api/admin/migrations/status | jq '.'
```

Should show all migrations as successful.

---

## Expected Improvements to See

With the new improved prompts:
- **Quest Generation**: More specific, creative titles instead of generic "Kill 10 Rats"
- **POI Descriptions**: Better atmospheric text with proper formatting
- **Name Generation**: More culturally appropriate, evocative names
- **Parse Success Rate**: Fewer ‚ö†Ô∏è parse errors in logs

---

## Troubleshooting

If you see parse errors after restart:

1. **Check logs**: `podman compose logs -f backend | grep -i parse`
2. **Verify backend started**: `podman compose ps`
3. **Check Supabase connection**: Ensure `.env` has correct SUPABASE_URL and SUPABASE_KEY
4. **Restart backend**: `podman compose down && podman compose up -d`

---

## After Testing

Once you've confirmed the new prompts are working:

1. ‚úÖ New quests have creative, specific titles
2. ‚úÖ POI descriptions are well-formatted
3. ‚úÖ Names are culturally appropriate
4. ‚úÖ Parse errors are significantly reduced

You can keep the cleared state or restore from backup if needed.
